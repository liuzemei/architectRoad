{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/util.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 拿到数组原型上的方法\n\nlet oldArrayProtoMethods = Array.prototype\n\n// 继承一下 arrayMethods.__proto__ = oldArrayProtoMethods\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\n\n\nlet methods = [\n  'push', 'pop', 'shift', 'unshift', 'reverse', 'sort', 'splice'\n]\n\nmethods.forEach(method => {\n  arrayMethods[method] = function (...args) { // this 就是 observer 里的 value\n    let inserted\n    let ob = this.__ob__\n    switch (method) {\n      case 'push':\n      case 'unshift': // 这两个方法都是追加 追加的内容可能是对象类型，应该被再次进行劫持\n        inserted = args\n        break\n      case 'splice': // vue.$set 原理\n        inserted = args.slice(2) // arr.splice(0,1,{a:1}) 在第0个索引，删除一个，并新增一个 a\n    }\n    if (inserted) ob.observeArray(inserted) // 数组新增的值也要进行观测\n    return oldArrayProtoMethods[method].apply(this, args)\n  }\n})\n\n","export function proxy(vm, data, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[data][key]\n    },\n    set(newValue) {\n      if (newValue === vm[data][key]) return\n      vm[data][key] = newValue\n    }\n  })\n}\n\nexport function defineProperty(data, key, value) {\n  Object.defineProperty(data, key, {\n    enumerable: false, // 不能被枚举(不能被循环出来)\n    configurable: false, // 不能被修改\n    value: value\n  })\n} ","import { arrayMethods } from \"./array\"\nimport { defineProperty } from \"../util\"\n\nclass Observer {\n  constructor(value) {\n    // 使用 defineProperty 重新定义属性\n    // 判断一个对象是否被监控\n    defineProperty(value, '__ob__', this)\n    if (Array.isArray(value)) {\n      value.__proto__ = arrayMethods\n      // 观测数组中的对象类型，对象变化也要做一些事\n      this.observeArray(value)\n    } else {\n      this.walk(value)\n    }\n  }\n\n  observeArray(value) {\n    for (let i = 0, len = value.length; i < len; i++) {\n      let item = value[i]\n      observe(item) // 观测数组中的对象类型\n    }\n  }\n\n  walk(data) {\n    let keys = Object.keys(data)\n    keys.forEach(key => {\n      defineReactive(data, key, data[key]) // Vue.util.defineReactive\n    })\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value)\n  Object.defineProperty(data, key, {\n    get() {\n      console.log('用户获取值了', data, key, value)\n      return value\n    },\n    set(newValue) {\n      console.log('用户设置值了', data, key, value)\n      if (newValue === value) return\n      observe(newValue)\n      value = newValue\n    }\n  })\n}\n\n\n\nexport function observe(data) {\n  // 是对象，且不能 null\n  if (typeof data !== 'object' || data === null || data.__ob__) return data\n  return new Observer(data)\n}","import { observe } from \"./observer/index\"\nimport { proxy } from './util'\n\nexport function initState(vm) {\n\n  const opts = vm.$options\n  if (opts.props) initProps(vm)\n  if (opts.methods) initMethods(vm)\n  if (opts.data) initData(vm)\n  if (opts.computed) initComputed(vm)\n  if (opts.watch) initWatch(vm)\n}\n\nfunction initProps(vm) { }\nfunction initMethods(vm) { }\n\n\n\nfunction initData(vm) {\n  let { data } = vm.$options\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\n  // 数据的劫持方案 对象 Object.defineProperty\n  // 数组 单独处理\n  // 当我去 vm 上 取属性时，帮我将属性的取值代理到 vm._data 上\n\n  for (let key in data) {\n    proxy(vm, '_data', key)\n  }\n\n  observe(data)\n}\nfunction initComputed(vm) { }\nfunction initWatch(vm) { }\n\n","\n\nfunction parseHTML(html) {\n\n}\n\n\n\n\n\nexport function compileToFunctions(template) {\n  // html 模板 => render 函数\n  // 1. 需要将 html 代码转化成 ast 语法书\n  // ast: 可以用 ast 数来描述语言本身\n\n  // 虚拟dom 是用对象来描述节点的\n  // <div id=\"a\"></div>\n  // {\n  //   attr: [{ id: 'a' }],\n  //   tag: 'div',\n  //   children: []\n  // }\n\n  // ast 语法树 还可以来描述js语法\n  // const a = 1;\n  // {\n  //   indentifier: const,\n  //   name: a,\n  //   value: 1\n  // }\n\n  // 虚拟dom 只能描述DOM，   ast语法树 是描述代码的 \n\n\n  // 前端必须要掌握的数据结构（树）\n  let ast = parseHTML(template)\n\n\n\n\n\n  // 2. 通过ask语法树 重新的生成代码\n\n\n\n\n\n\n\n\n}","import { initState } from \"./state\"\nimport { compileToFunctions } from \"./compiler/index\"\n\nexport function initMixin(Vue) {\n\n  Vue.prototype._init = function (options) {\n    const vm = this\n    vm.$options = options\n\n    // 初始化状态（将数据做一个初始化的劫持 当我改变数据时应该更新视图）\n    // vue 组件中有很多状态 data props watch computed\n    initState(vm)\n    // vue 里边核心特性 响应式数据源里\n    // Vue 是一个什么样的框架 MVVM\n    // 数据变化视图会更新，视图变化数据会被影响（MVVM: 不能跳过数据区更新视图，但是Vue没有遵循MVVM，$ref）\n\n\n    // 如果当前有 el 属性，说明要渲染模板\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el)\n    }\n  }\n\n  Vue.prototype.$mount = function (el) {\n    // 挂载操作\n    const vm = this\n    const opts = vm.$options\n    el = document.querySelector(el)\n\n\n    if (!opts.render) {\n      // 没 render\n      let template = opts.template\n      if (!template && el) {\n        template = el.outerHTML\n      }\n      const render = compileToFunctions(template)\n      opts.render = render\n    }\n  }\n}","import { initMixin } from \"./init\"\n\n\n\nfunction Vue(options) {\n  this._init(options) // 入口方法，做初始化操作\n}\n\n\n// 写成一个个的插件进行对原型的扩展\n// 初始化方法\ninitMixin(Vue)\n\n\n\nexport default Vue\n\n\n\n// export const fn = () => {\n//   console.log(123)\n// }"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","inserted","ob","__ob__","args","slice","observeArray","apply","proxy","vm","data","key","defineProperty","get","set","newValue","value","enumerable","configurable","Observer","isArray","__proto__","walk","i","len","length","item","observe","keys","defineReactive","console","log","initState","opts","$options","props","initProps","initMethods","initData","computed","initComputed","watch","initWatch","_data","call","compileToFunctions","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}